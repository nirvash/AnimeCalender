# データ自動更新仕様

## 概要
- しょぼいカレンダーAPIから取得したアニメ番組データを、定期的かつ手動で最新化する仕組みについて記載。

---

## 更新タイミング

- 定期自動更新：バックエンドでcron（node-cron等）を用い、1日1回（または数時間ごと）自動でAPIからデータ取得・更新
- 手動更新：フロントエンドの「今すぐ更新」ボタン押下時に即時API取得・更新

---

## 更新処理フロー

1. しょぼいカレンダーAPIから最新データ（Title, Prog, Ch）を取得
2. 既存DBデータと比較し、差分（新規追加・変更・削除）を検出
3. 新規番組・放送時間変更・終了番組をDBに反映
4. 必要に応じてユーザーへ通知（放送時間変更・新番組追加等）

---

## 差分検出・反映

- 番組ID（syobocal_tid）をキーに、既存データとAPIデータを比較
- 新規番組：DBに追加
- 放送時間・局・タイトル等の変更：DBを更新
- 終了番組：end_dateを設定し、視聴済み一覧に自動移動

---

## 障害時の対応

- API取得失敗時はリトライ（最大3回等）
- 取得失敗時は前回データを保持し、ユーザーにエラー通知（拡張）

---

## 備考

- 更新頻度や通知内容は将来的に設定画面で変更可能に拡張
- APIアクセス制限・利用規約に注意
